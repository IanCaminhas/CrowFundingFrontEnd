<!DOCTYPE html>
<html lang="pt-br">

<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>CrowFunding - Novo Aluno</title>

  <!-- Custom fonts for this template-->
  <link href="../../vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">


  <!-- Custom styles for this template-->
  <link href="../../css/sb-admin.css" rel="stylesheet">

  <!-- JQUERY-->
  <script src="../../js/jquery.min.js"></script>


</head>

<body class="bg-dark">

    <div class="containter-fluid card-register mx-auto mt-5 text-white ">

        <!-- Page Content -->
        <h1>Novo Aluno</h1>
        <hr style="border-color: white;">
        <p class="text-center">Insira corretamente todos os dados do Aluno</p>

        <form class="needs-validation" novalidate>
          <div class="form-row">
            <div class="col-md-12 mb-3">
              <label for="nomeAluno">Nome do Aluno</label>
              <input type="text" class="form-control" id="nomeAluno" name="nome" placeholder="Nome da Aluno"
                required>
              <div class="valid-feedback">
                Parece bom!
              </div>
              <div class="invalid-feedback">
                Digite o Nome do Aluno.
              </div>
            </div>
            <div class="col-md-3 mb-3">
              <label for="cpf">CPF</label>
              <input type="text" class="form-control" id="cpf" name="cpf" placeholder="CPF" required>
              <div class="valid-feedback">
                Parece bom!
              </div>
              <div class="invalid-feedback">
                Digite o CPNJ.
              </div>
            </div>
            <div class="col-md-4 mb-3">
              <label for="telefone">Telefone</label>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text" id="inputGroupPrepend">+55</span>
                </div>
                <input type="text" class="form-control phone_with_ddd" id="telefone" name="telefone"
                  placeholder="Telefone" aria-describedby="inputGroupPrepend" required>
                <div class="valid-feedback">
                  Parece bom!
                </div>
                <div class="invalid-feedback">
                  Digite um telefone.
                </div>
              </div>
            </div>
            <div class="col-md-2 mb-3">
              <label for="rendaPerCapita">Renda per capta</label>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text" id="inputGroupPrepend">R$</span>
                </div>
                <input type="text" class="form-control" id="rendaPerCapita" name="rendaPerCapta"
                  aria-describedby="inputGroupPrepend" required>
                <div class="valid-feedback">
                  Parece bom!
                </div>
                <div class="invalid-feedback">
                  Digite o valor da renda.
                </div>
              </div>
            </div>

            <div class="col-md-3 mb-3">
              <label for="rendaPerCapita">Data nascimento</label>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text" id="inputGroupPrepend"><i class="fas fa-calendar fa-fw"></i></span>
                </div>
                <input type="date" class="form-control" id="dataNascimento" name="rendaPerCapta"
                  aria-describedby="inputGroupPrepend" required>
                <div class="valid-feedback">
                  Parece bom!
                </div>
                <div class="invalid-feedback">
                  Digite a sua data de nascimento
                </div>
              </div>
            </div>



            <div class="col-md-12 mb-3">
              <label for="email">E-mail</label>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text" id="inputGroupPrepend">@</span>
                </div>
                <input type="text" class="form-control" id="email" name="email" placeholder="E-mail"
                  aria-describedby="inputGroupPrepend" required>
                <div class="valid-feedback">
                  Parece bom!
                </div>
                <div class="invalid-feedback">
                  Digite um E-mail.
                </div>
              </div>

            </div>
            <div class="col-md-12 mb-3">
              <label for="descricaoPerfil">Descrição do perfil</label>
              <textarea type="text" class="form-control" id="descricaoPerfil" name="descricaoPerfil"
                placeholder="Descreva seu perfil com poucas palavras" required></textarea>
              <div class="valid-feedback">
                Parece bom!
              </div>
              <div class="invalid-feedback">
                A descrição da instituição é obrigatória.
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <label for="senha">Digite uma senha</label>
                  <input type="password" class="form-control" id="senha" name="senha" placeholder="Senha" required>
                <div class="valid-feedback">
                  Parece bom!
                </div>
                <div class="invalid-feedback">
                  Digite uma senha válida.
                </div>
            </div>
            <div class="col-md-6 mb-3">
              <label for="confirmaSenha">Confirme sua senha</label>
                  <input type="password" class="form-control" id="confirmarSenha" name="confirmarSenha" placeholder="Confirme sua senha" required>
                  <span class="text-danger" id="invalidFeedbackSenha"></span>
                <div class="valid-feedback">
                  Parece bom!
                </div>
                <div class="invalid-feedback">
                  As senhas não são iguais.
                </div>
            </div>

          </div>
          <h3 class="text-center">Dados de Moradia</h3>
          <hr style="border-color: white;">
          <div class="form-row">  
            <div class="col-md-3 mb-3">
                <label for="rua">Rua</label>
                    <input type="text" class="form-control" id="rua" name="rua" placeholder="Rua" required>
                  <div class="valid-feedback">
                    Parece bom!
                  </div>
                  <div class="invalid-feedback">
                    Digite o nome da sua rua.
                  </div>
              </div>
              <div class="col-md-3 mb-3">
                <label for="numeroPropriedade">Numero</label>
                    <input type="text" class="form-control" id="numeroPropriedade" name="numeroPropriedade" placeholder="Número" required>
                  <div class="valid-feedback">
                    Parece bom!
                  </div>
                  <div class="invalid-feedback">
                    Digite um número.
                  </div>
              </div>
              <div class="col-md-6 mb-3">
                  <label for="bairro">Bairro</label>
                      <input type="text" class="form-control" id="bairro" name="bairro" placeholder="Bairro" required>
                    <div class="valid-feedback">
                      Parece bom!
                    </div>
                    <div class="invalid-feedback">
                      Digite o bairro.
                    </div>
                </div>

                <div class="col-md-6 mb-3">
                    <label for="complemento">Complemento</label>
                        <input type="text" class="form-control" id="complemento" name="complemento" placeholder="Complemento" required>
                      <div class="valid-feedback">
                        Parece bom!
                      </div>
                      <div class="invalid-feedback">
                        Digite o Complemento.
                      </div>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label for="logradouro">Logradouro</label>
                        <input type="text" class="form-control" id="logradouro" name="logradouro" placeholder="Logradouro" required>
                      <div class="valid-feedback">
                        Parece bom!
                      </div>
                      <div class="invalid-feedback">
                        Digite o Logradouro.
                      </div>
                  </div>
                </div>
                  <button class="btn btn-primary" id="btnCadastrar">Cadastrar</button>
                  <div id="email-existente"></div>
          </div>
         
        </form>

    </div>

    <div id="email-existente"></div>

  </body>

  <script>
$('#btnCadastrar').click(function () {
    event.preventDefault();
  
    var url = 'http://localhost:8080/alunos/cadastrar';

   
     var data = { 
       //class(model) aluno
      nome: $('#nomeAluno').val(),
      telefone: $('#telefone').val(),
      email: $('#email').val(),
      dataNascimento: getData($('input[type=date]').val()),
      cpf: $('#cpf').val(),
      descricaoPerfil: $('#descricaoPerfil').val(),      
      rendaPerCapita: $('#rendaPerCapita').val(),
      senha: $('#senha').val(),
    
      //class endereço
      rua: $('#rua').val(),
      bairro: $('#bairro').val(),
      numeroPropriedade:$('#numeroPropriedade').val(),
      complemento:$('#complemento').val(),
      logradouro: $('#logradouro').val()
      
    };
    call(url, data);
    
  });

  function getData(data){
    let date = new Date(data);
    day = date.getDate();
    month = date.getMonth() + 1;
    year = date.getFullYear();
    return [day, month, year].join('/');

  }




  function call(url, data) {
  var request = $.ajax({
    url : url,
    method : "POST",
    async: false,
    headers: {
      'Content-Type': 'application/json'
    },
    data : JSON.stringify(data)
  });

  request.done(function(resp) {
    sessionStorage.setItem('aluno', resp);
  window.location.replace("indexAluno.html");



  });

  request.fail(function(jqXHR, textStatus) {
    $('#email-existente').html(exibirAlertErroEmailExistente());
  });
};

function exibirAlertErroEmailExistente(){
  let alert =`<div class="alert alert-danger" role="alert">
  email existente, por favor use outro email
  </div>`;
return alert;
}

  </script>

</html>
<script>
  // Example starter JavaScript for disabling form submissions if there are invalid fields
  (function () {
    'use strict';
    window.addEventListener('load', function () {
      // Fetch all the forms we want to apply custom Bootstrap validation styles to
      var forms = document.getElementsByClassName('needs-validation');
      // Loop over them and prevent submission
      var validation = Array.prototype.filter.call(forms, function (form) {
        form.addEventListener('submit', function (event) {
          if (form.checkValidity() === false) {
            event.preventDefault();
            event.stopPropagation();
          }
          form.classList.add('was-validated');
        }, false);
      });
    }, false);
  })();
</script>

<script>

$(document).ready(function(){
  $('#invalidFeedbackSenha').hide();
})

$('#confirmarSenha').change(function(){
  let senha = $('#senha').val();
  let confirmarSenha = $('#confirmarSenha').val();

  if( senha != confirmarSenha ){    
    $('#invalidFeedbackSenha').show().html("As senhas não coincidem");
  }
  else{
    
    $('#invalidFeedbackSenha').html("As senhas são iguais").prop('class', 'text-success');
    setTimeout(5000, function(){
      $('#invalidFeedbackSenha').hide();
    })
  }
})

</script>


<script type="text/javascript">
//Mascara para telefone
  $(document).ready(function(){

  var SPMaskBehavior = function (val) {
    return val.replace(/\D/g, '').length === 11 ? '(00) 00000-0000' : '(00) 0000-00009';
  },
  spOptions = {
    onKeyPress: function(val, e, field, options) {
    field.mask(SPMaskBehavior.apply({}, arguments), options);
    }
  };
  $("#telefone").mask(SPMaskBehavior, spOptions);	

  })
</script>