<!DOCTYPE html>
<html lang="pt-br">

<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>CrowFunding - Alunos</title>

  <!-- Custom fonts for this template-->
  <link href="../../vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">

  <!-- Page level plugin CSS-->
  <link href="../../vendor/datatables/dataTables.bootstrap4.css" rel="stylesheet">

  <!-- Custom styles for this template-->
  <link href="../../css/sb-admin.css" rel="stylesheet">

</head>

<body id="page-top">

  <nav class="navbar navbar-expand navbar-dark bg-dark static-top">

    <a class="navbar-brand mr-1" href="index.html">CrowFunding</a>

    <button class="btn btn-link btn-sm text-white order-1 order-sm-0" id="sidebarToggle" href="#">
      <i class="fas fa-bars"></i>
    </button>

    <div class="d-none d-md-inline-block form-inline ml-auto mr-0 mr-md-3 my-2 my-md-0 text-white bolder text-center">
      Instituição
    </div>

    <!-- Navbar -->
    <ul class="navbar-nav ml-auto ml-md-0">

      <li class="nav-item dropdown no-arrow">
        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown"
          aria-haspopup="true" aria-expanded="false">
          <i class="fas fa-user-circle fa-fw"></i>
        </a>
        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userDropdown">
          <a class="dropdown-item" href="#">Meu dados</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="#" data-toggle="modal" data-target="#logoutModal">Logout</a>
        </div>
      </li>
    </ul>

  </nav>

  <div id="wrapper">

      <ul class="sidebar navbar-nav">
          <li class="nav-item active">
            <a class="nav-link" href="indexInstituicao.html">
              <i class="fas fa-fw fa-home"></i>
              <span>Inicio</span>
            </a>
          </li>
          <li class="nav-item">
              <li class="nav-item active" >
            <a class="nav-link" href="cursos.html">
              <i class="fas fa-fw fa-list"></i>
              <span>Cursos</span>
            </a>
          </li>
          <li class="nav-item">
              <li class="nav-item active" >
              <a class="nav-link" href="alunos.html">
                <i class="fas fa-fw fa-list"></i>
                <span>Alunos</span>
              </a>
            </li>   
                <li class="nav-item">
                    <li class="nav-item active" >
                    <a class="nav-link" href="turmas.html">
                      <i class="fas fa-fw fa-list"></i>
                      <span>Turmas</span>
                    </a>
                  </li>
            
           
            <li class="nav-item">
                <li class="nav-item active" >
                <a href="../../index.html" class="nav-link"  onclick="encerrarSessao()">
                  <i class="fas fa-sign-out-alt"></i>
                  <span>sair</span>
                </a>
              </li>
        </ul>




    <!-- Fim Modal -->

    <div id="content-wrapper">

      <div class="container-fluid">

        <!-- Breadcrumbs-->
        <ol class="breadcrumb">
          <li class="breadcrumb-item">
            <a href="indexInstituicao.html">Inicio</a>
          </li>
          <li class="breadcrumb-item active">
            <a href="#">Alunos</a>
          </li>
        </ol>

        <div class="text-center">
          <h1 class="display-4">Alunos pendentes - Acesso Instituição</h1>
          <br>
        </div>

        <!-- Inicio Modal -->
        <div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
          aria-hidden="true">
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Nova Turma</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>

              <div class="modal-body">
                <form class="needs-validation" novalidate>
                  <div class="form-row">
                    <div class="col-md-12 mb-3">
                      <label for="numeroVagas">Curso</label>
                      <select type="number" class="form-control" id="numeroVagas" name="numeroVagas"
                        placeholder="Quantidade de vagas" required>
                        <option disabled selected>Selecione um curso</option>
                        <option value="1">Excel Avançado</option>
                      </select>
                      <div class="valid-feedback">
                        Parece bom!
                      </div>
                      <div class="invalid-feedback">
                        Digite a quantidade de vagas para essa turma.
                      </div>
                    </div>
                    <div class="col-md-12 mb-3">
                      <label for="numeroVagas">Número de Vagas</label>
                      <input type="number" class="form-control" id="numeroVagas" name="numeroVagas"
                        placeholder="Quantidade de vagas" required>
                      <div class="valid-feedback">
                        Parece bom!
                      </div>
                      <div class="invalid-feedback">
                        Digite a quantidade de vagas para essa turma.
                      </div>
                    </div>
                    <div class="col-md-12 mb-1">
                      <p class="text-center">Horário de início e término das aulas</p>
                    </div>
                    <div class="col-md-6 mb-3">
                      <div class="input-group">
                        <div class="input-group-prepend">
                          <span class="input-group-text" id="inputGroupPrepend">Inicio</span>
                        </div>
                        <input type="time" class="form-control" id="horaInicio" name="horaInicio"
                          aria-describedby="inputGroupPrepend" required>
                        <div class="valid-feedback">
                          Parece bom!
                        </div>
                        <div class="invalid-feedback">
                          Digite a hora inicial.
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6 mb-3">
                      <div class="input-group">
                        <div class="input-group-prepend">
                          <span class="input-group-text" id="inputGroupPrepend">Término</span>
                        </div>
                        <input type="time" class="form-control" id="horaTermino" name="horaTermino"
                          aria-describedby="inputGroupPrepend" required>
                        <div class="valid-feedback">
                          Parece bom!
                        </div>
                        <div class="invalid-feedback">
                          Digite a hora de término.
                        </div>
                      </div>
                    </div>
                    <div class="col-md-12 mb-1">
                      <p class="text-center">Data de início e término das aulas</p>
                    </div>
                    <div class="col-md-6 mb-3">
                      <div class="input-group">
                        <div class="input-group-prepend">
                          <span class="input-group-text" id="inputGroupPrepend">Início</span>
                        </div>
                        <input type="date" class="form-control" id="dataInicio" name="dataInicio"
                          aria-describedby="inputGroupPrepend" required>
                        <div class="valid-feedback">
                          Parece bom!
                        </div>
                        <div class="invalid-feedback">
                          Digite a data inicial.
                        </div>
                      </div>
                    </div>
                    <div class="col-md-6 mb-3">
                      <div class="input-group">
                        <div class="input-group-prepend">
                          <span class="input-group-text" id="inputGroupPrepend">Término</span>
                        </div>
                        <input type="date" class="form-control" id="dataTermino" name="dataTermino"
                          aria-describedby="inputGroupPrepend" required>
                        <div class="valid-feedback">
                          Parece bom!
                        </div>
                        <div class="invalid-feedback">
                          Digite a data de término.
                        </div>
                      </div>
                    </div>

                  </div>
                  <hr>
                  <button class="btn btn-primary" id="btnCadastrar">Cadastrar</button>
                </form>
              </div>
            </div>
          </div>
        </div>


        <div class="card mb-3">
          <div class="card-header">
            <i class="fas fa-table"></i>
            Alunos com solicitação em aberto</div>
          <div class="card-body">
              <div class="table-responsive">
                <div id="tabela"></div>
              </div>
              <div id="espacoModal"></div>
          </div>
          <div class="card-footer small text-muted">Updated yesterday at 11:59 PM</div>
        </div>


      </div>
      <!-- /.container-fluid -->

      <!-- Sticky Footer -->
      <footer class="sticky-footer">
        <div class="container my-auto">
          <div class="copyright text-center my-auto">
            <span>Copyright © CrowFunding 2019</span>
          </div>
        </div>
      </footer>

    </div>
    <!-- /.content-wrapper -->

  </div>
  <!-- /#wrapper -->

  <!-- Scroll to Top Button-->
  <a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
  </a>

  <!-- Logout Modal-->
  <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
          <button class="close" type="button" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">×</span>
          </button>
        </div>
        <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
          <a class="btn btn-primary" href="login.html">Logout</a>
        </div>
      </div>
    </div>
  </div>

  <div id="modalPerfil"></div>

  <!-- Bootstrap core JavaScript-->
  <script src="../../vendor/jquery/jquery.min.js"></script>
  <script src="../../vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Core plugin JavaScript-->
  <script src="../../vendor/jquery-easing/jquery.easing.min.js"></script>

  <!-- Page level plugin JavaScript-->
  <script src="../../vendor/chart.js/Chart.min.js"></script>
  <script src="../../vendor/datatables/jquery.dataTables.js"></script>
  <script src="../../vendor/datatables/dataTables.bootstrap4.js"></script>

  <!-- Custom scripts for all pages-->
  <script src="../../js/sb-admin.min.js"></script>

  <!-- Demo scripts for this page-->
  <script src="../../js/demo/datatables-demo.js"></script>
  <script src="../../js/demo/chart-area-demo.js"></script>

</body>

</html>

<script>
  // Example starter JavaScript for disabling form submissions if there are invalid fields
  (function () {
    'use strict';
    window.addEventListener('load', function () {
      // Fetch all the forms we want to apply custom Bootstrap validation styles to
      var forms = document.getElementsByClassName('needs-validation');
      // Loop over them and prevent submission
      var validation = Array.prototype.filter.call(forms, function (form) {
        form.addEventListener('submit', function (event) {
          if (form.checkValidity() === false) {
            event.preventDefault();
            event.stopPropagation();
          }
          form.classList.add('was-validated');
        }, false);
      });
    }, false);
  })();
</script>

<script>
   
    function createTable(){

        let tabela =`
        <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                <thead>
                  <tr>
                    <th hidden>id Aluno</th>
                    <th hidden>id Turma</th>
                    <th hidden>enderecoAluno</th>   
                    <th hidden>rendaPerCapita</th> 
                    <th hidden>descricaoPerfil</th>  
                    <th hidden>ementa</th>                                                                          
                    <th>Nome do Aluno</th>
                    <th>Nome do Curso</th>
                    <th>Hora Início</th>
                    <th>Hora Término</th>
                    <th>Data Início</th>
                    <th>Data Prev. Término</th>
                    <th>Status</th>
                    <th hidden>endereco</th>
                    <th>Perfil aluno</th>
                    <th>Ações</th>
                  </tr>
                </thead>
                <tbody id="table-alunos">
                 
                </tbody>
              </table>`;
        return tabela;
    }

     jQuery(function ($) {

        $("#tabela").html(createTable());
        let idInstituicao = JSON.parse(sessionStorage.getItem('instituicao'))['id'];
        let url = `http://localhost:8080/matriculas/analise/${idInstituicao}`;
        let tabela = document.querySelector('#table-alunos');

        $.get(url, function (data) {
            //alert(data);
            //let dados = JSON.parse(data);
            
            data.forEach(function(d, index){
              let tr = document.createElement('tr');
              if(d.status != 'Em análise pela instituição'){
                tr.innerHTML = ` 
            <td hidden>${d.idAluno}</td>
            <td hidden>${d.idTurma}</td>
            <td hidden>${d.enderecoAluno}</td>
            <td hidden>${d.rendaPerCapita}</td>
            <td hidden>${d.descricaoPerfil}</td>
            <td hidden>${d.ementa}</td>
            <td>${d.nomeAluno}</td>
            <td>${d.nomeCurso}</td>
            <td>${d.horaInicio}</td>
            <td>${d.horaTermino}</td>
            <td>${d.dataInicio}</td>
            <td>${d.dataTermino}</td>
            <td>${d.status}</td>
            <td hidden>${d.endereco}</td>
            <td>
            <div class="text-center">
            <p>
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#alert-perfil-aluno">
                mais
            </button>
            </p>
            </div>
            </td>
            <button type="button" class="btn btn-primary" disabled>
                Aprovar
            </button>  

            <button type="button" class="btn btn-danger" disabled>
                Reprovar
            </button>
            <td>
            </td>      
  `;
              } else{

                tr.innerHTML = ` 
            <td hidden>${d.idAluno}</td>
            <td hidden>${d.idTurma}</td>
            <td hidden>${d.enderecoAluno}</td>
            <td hidden>${d.rendaPerCapita}</td>
            <td hidden>${d.descricaoPerfil}</td>
            <td hidden>${d.ementa}</td>
            <td>${d.nomeAluno}</td>
            <td>${d.nomeCurso}</td>
            <td>${d.horaInicio}</td>
            <td>${d.horaTermino}</td>
            <td>${d.dataInicio}</td>
            <td>${d.dataTermino}</td>
            <td>${d.status}</td>
            <td>
            <div class="text-center">
            <p>
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#alert-perfil-aluno">
                exibir
            </button>
            </p>
            </div>
            </td>
            <button type="button" onclick="aprovarAluno(${d.idAluno}, ${d.idTurma})" class="btn btn-primary">
                Aprovar
            </button>  

            <button type="button"  onclick="reprovarAluno(${d.idAluno}, ${d.idTurma})" class="btn btn-danger">
                Reprovar
            </button>
            <td>
            </td>      
  `;
              }

            
            tabela.appendChild(tr);
            
        });
        $('#dataTable').DataTable( {});

      
    });

    $('#dataTable tbody').on( 'click','tr' ,function () {
        var table = $('#dataTable').DataTable();

        let linhaSelecionada= table.row(this).index();
        let data = table.rows(linhaSelecionada).data();
        
        let infoMatricula = data[0];

        let idAluno = infoMatricula[0];
        let idTurma = infoMatricula[1];
        let endereco = infoMatricula[2];
        let renda = infoMatricula[3];
        let perfil = infoMatricula[4];
        let ementa = infoMatricula[5];
        let nomeAluno = infoMatricula[6];
        let nomeCurso = infoMatricula[7];
        let hInicio = infoMatricula[8];
        let hTermino = infoMatricula[9];
        let dtInicio = infoMatricula[10];
        let dtTermino = infoMatricula[11];
        let status = infoMatricula[12];

        var objPerfilAluno ={
          renda: renda,
          perfil: perfil,
          endereco: endereco
        } 

        

        $('#modalPerfil').append(modalPerfilAluno(objPerfilAluno));

    });



    function modalPerfilAluno(objPerfilAluno){
  let modal=`<div class="modal" tabindex="-1" id="alert-perfil-aluno" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" > Perfil </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Perfil: ${objPerfilAluno.perfil}</p>
        <p>Renda Percapita: ${objPerfilAluno.renda}</p>
        <p>Endereco: ${objPerfilAluno.endereco}</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
      </div>
    </div>
  </div>
</div>`;
return modal;
}
     });
</script>

<script>
    function reprovarAluno(aluno,turma){
      event.preventDefault();
    
            var url = 'http://localhost:8080/matriculas/reprovar';
            let data = { 
            //dados matricula
            idTurma: turma,
            idAluno: aluno,
          
          };
            call(url, data);
        }
    
        function call(url, data) {
            var request = $.ajax({
            url : url,
            async: false,
            method : "POST",
            headers: {
                'Content-Type': 'application/json'
            },
            data : JSON.stringify(data),
        });
    
            request.done(function(resp) {
              location.reload(); 
        });
    
            request.fail(function(jqXHR, textStatus) {

    });
    };
    </script>
    

    <script>
        function aprovarAluno(aluno,turma){
          event.preventDefault();    
                var url = 'http://localhost:8080/matriculas/aprovar';
                let data = { 
                //dados matricula
                idTurma: turma,
                idAluno: aluno,
               };
                call(url, data);
            }
        
            function call(url, data) {
                var request = $.ajax({
                url : url,
                async: false,
                method : "POST",
                headers: {
                    'Content-Type': 'application/json'
                },
                data : JSON.stringify(data),
            });
        
                request.done(function(resp) {
                  location.reload(); 
                    
            });
        
                request.fail(function(jqXHR, textStatus) {
                  location.reload();  

        });
        };
        
        
        </script>
        
        <script>
            function encerrarSessao(){
              sessionStorage.removeItem('instituicao');
            
            }    
           </script>